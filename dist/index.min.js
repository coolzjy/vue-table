var VueTable=function(t){"use strict";function e(t,e){var i=0;if(Array.isArray(t))t=t[e?1:0];else if(e)return i;return"number"==typeof t&&t>0&&(i=t),i}function i(t){function e(t){return 20*t}return t.map(function(t){if("string"==typeof t)return e(t.length);if("object"==typeof t){if("number"==typeof t.width)return t.width;if("string"==typeof t.title)return e(t.title.length)}return l})}function o(t,e){var i=t.reduce(function(t,e){return t+e},0);if(i>=e)return t;var o=e-i;return t.map(function(t){return t+o*t/i})}function n(t,e){return JSON.stringify(t)===JSON.stringify(e)}function s(t,e,i){if("string"==typeof t)return t;if("object"==typeof t){if("function"==typeof t.headComponent)return i(t.headComponent,{props:{column:t,dataBus:e}});if("string"==typeof t.title)return t.title}}function r(t,e){var i=Object.prototype.toString.call(t),o="[object Array]"===i||"[object NodeList]"===i||"[object HTMLCollection]"===i||"[object Object]"===i||"undefined"!=typeof jQuery&&t instanceof jQuery||"undefined"!=typeof Elements&&t instanceof Elements,n=0,s=t.length;if(o)for(;n<s;n++)e(t[n]);else e(t)}function u(t,e,i,o,n){if("string"==typeof t)return e[t];if("object"==typeof t){if("function"==typeof t.bodyComponent)return n(t.bodyComponent,{props:{column:t,row:e,index:i,dataBus:o}});if("string"==typeof t.prop)return e[t.prop]}}function h(t,e){this._from=null,this._to=[],this._sync=function(i){for(var o=i.target,n=0;n<this._to.length;n++)t&&(this._to[n].scrollTop=o.scrollTop),e&&(this._to[n].scrollLeft=o.scrollLeft)}.bind(this)}t=t&&t.hasOwnProperty("default")?t.default:t;var l=100,a={props:{fixed:String,columns:{type:Array,required:!0},dataBus:null,layout:{type:Object,required:!0}},computed:{width:function(){return this.layout[this.fixed?this.fixed+"ColumnWidth":"columnWidth"]},totalWidth:function(){return this.layout[this.fixed?this.fixed+"TotalWidth":"totalWidth"]},tableStyle:function(){if(this.totalWidth)return{width:this.totalWidth+"px"}}}},d={name:"table-head-cell",props:{column:{type:[String,Object],required:!0},dataBus:null},methods:{resizeStart:function(t){this.start=t.clientX,document.body.classList.add("vt__dragging"),document.addEventListener("mouseup",this.resizeEnd)},resizeEnd:function(t){document.body.classList.remove("vt__dragging"),this.$emit("resize",this.column,t.clientX-this.start),document.removeEventListener("mouseup",this.resizeEnd)}},render:function(t){return t("th",{staticClass:"vt__th"},[s(this.column,this.dataBus,t),!this.column.disableResize&&t("div",{class:"vt-resize-handle",on:{mousedown:this.resizeStart}},[])])}},c={name:"table-head",mixins:[a],computed:{rowStyle:function(){if(this.fixed)return{height:this.layout.headRowHeight+"px"}}},methods:{columnResize:function(t,e,i){this.$emit("columnResize",t,e,i)},updateHeight:function(){var t=this;this.$nextTick(function(e){t.layout.headHeight=t.$refs.head.offsetHeight,t.layout.headRowHeight=t.$refs.row.offsetHeight})}},mounted:function(){var t=this;this.fixed||(this.updateHeight(),this.$nextTick(function(e){t.layout.hss.to(t.$refs.head)}))},updated:function(){this.fixed||this.updateHeight()},beforeDestroy:function(){this.fixed||this.layout.hss.off(this.$refs.head)},render:function(t){var e=this;return t("div",{staticClass:"vt-table-head",ref:"head"},[t("table",{staticClass:"vt__table",style:this.tableStyle},[t("colgroup",null,[this.width.map(function(e){return t("col",{style:{width:e+"px"}},[])})]),t("tr",{staticClass:"vt__tr",style:this.rowStyle,ref:"row"},[this.columns.map(function(i,o){return t(d,{attrs:{column:i,dataBus:e.dataBus},on:{resize:e.columnResize},key:o},[])})])])])}},f=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(t){return window.setTimeout(t,20)},y=function(t,e){function i(){var t=[];this.add=function(e){t.push(e)};var e,i;this.call=function(){for(e=0,i=t.length;e<i;e++)t[e].call()},this.remove=function(o){var n=[];for(e=0,i=t.length;e<i;e++)t[e]!==o&&n.push(t[e]);t=n},this.length=function(){return t.length}}function o(t,e){if(t)if(t.resizedAttached)t.resizedAttached.add(e);else{t.resizedAttached=new i,t.resizedAttached.add(e),t.resizeSensor=document.createElement("div"),t.resizeSensor.className="resize-sensor";var o="position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;",n="position: absolute; left: 0; top: 0; transition: 0s;";t.resizeSensor.style.cssText=o,t.resizeSensor.innerHTML='<div class="resize-sensor-expand" style="'+o+'"><div style="'+n+'"></div></div><div class="resize-sensor-shrink" style="'+o+'"><div style="'+n+' width: 200%; height: 200%"></div></div>',t.appendChild(t.resizeSensor),t.resizeSensor.offsetParent!==t&&(t.style.position="relative");var s,r,u,h,l=t.resizeSensor.childNodes[0],a=l.childNodes[0],d=t.resizeSensor.childNodes[1],c=t.offsetWidth,y=t.offsetHeight,m=function(){a.style.width="100000px",a.style.height="100000px",l.scrollLeft=1e5,l.scrollTop=1e5,d.scrollLeft=1e5,d.scrollTop=1e5};m();var p=function(){r=0,s&&(c=u,y=h,t.resizedAttached&&t.resizedAttached.call())},v=function(){u=t.offsetWidth,h=t.offsetHeight,(s=u!=c||h!=y)&&!r&&(r=f(p)),m()},g=function(t,e,i){t.attachEvent?t.attachEvent("on"+e,i):t.addEventListener(e,i)};g(l,"scroll",v),g(d,"scroll",v)}}r(t,function(t){o(t,e)}),this.detach=function(e){y.detach(t,e)}};y.detach=function(t,e){r(t,function(t){t&&(t.resizedAttached&&"function"==typeof e&&(t.resizedAttached.remove(e),t.resizedAttached.length())||t.resizeSensor&&(t.contains(t.resizeSensor)&&t.removeChild(t.resizeSensor),delete t.resizeSensor,delete t.resizedAttached))})};var m={name:"table-body-cell",functional:!0,props:{column:{type:[String,Object],required:!0},row:{type:Object,required:!0},index:{type:Number,required:!0},dataBus:null},render:function(t,e){var i=u(e.props.column,e.props.row,e.props.index,e.props.dataBus,t);return t("td",{staticClass:"vt__td",class:{vt__td__covered:e.props.covered},attrs:{title:"string"==typeof i?i:""}},[i])}},p={name:"table-body",mixins:[a],props:{rows:{type:Array,required:!0}},methods:{getRowClass:function(t){return{vt__tr__hover:t===this.layout.hoveredRowIndex}},getRowStyle:function(t){if(this.fixed)return"number"==typeof this.layout.bodyRowHeight[t]?{height:this.layout.bodyRowHeight[t]+"px"}:void 0},updateHoveredRowIndex:function(t){this.layout.hoveredRowIndex=t},updateWidth:function(){this.layout.bodyWidth=this.$refs.body.clientWidth},updateScrollX:function(){var t=this.$refs.body;this.layout.scrollX=t.offsetHeight-t.clientHeight},updateScrollY:function(){var t=this.$refs.body;this.layout.scrollY=t.offsetWidth-t.clientWidth},updateRowHeight:function(t){if(this.$refs.rows){var e=this.$refs.rows.map(function(t){return t.offsetHeight});n(e,this.layout.bodyRowHeight)&&!t||(this.layout.bodyRowHeight=e)}}},created:function(){this.fixed||(this.layout.$on("updatescrollx",this.updateScrollX),this.layout.$on("updatescrolly",this.updateScrollY),this.layout.$on("updatebodywidth",this.updateWidth),this.layout.$on("updaterowheight",this.updateRowHeight))},mounted:function(){var t=this;this.$nextTick(function(e){var i=t.$refs.body;t.layout.vss[t.fixed?"to":"from"](i),t.fixed||(t.updateWidth(),t.layout.hss.from(i),t.resizeSensor=new y(i,t.updateWidth))})},beforeDestroy:function(){var t=this.$refs.body;this.layout.vss.off(t),this.fixed||(this.layout.hss.off(t),this.layout.$off("updatescrollx",this.updateScrollX),this.layout.$off("updatescrolly",this.updateScrollY),this.layout.$off("updatebodywidth",this.updateWidth),this.resizeSensor.detach())},render:function(t){var e=this;return t("div",{ref:"body",staticClass:"vt-table-body",style:{"overflow-y":this.fixed?"hidden":"auto"}},[t("table",{staticClass:"vt__table",style:this.tableStyle},[t("colgroup",null,[this.width.map(function(e){return t("col",{style:{width:e+"px"}},[])})]),this.rows.map(function(i,o){return t("tr",{staticClass:"vt__tr",class:e.getRowClass(o),style:e.getRowStyle(o),on:{mouseenter:function(t){e.updateHoveredRowIndex(o)}},key:o,ref:"rows",refInFor:!0},[e.columns.map(function(n,s){return t(m,{attrs:{column:n,row:i,index:o,dataBus:e.dataBus},key:s},[])})])})])])}};h.prototype.from=function(t){t&&t.addEventListener&&(this._from=t,this._from.addEventListener("scroll",this._sync))},h.prototype.to=function(t){t&&this._to.push(t)},h.prototype.sync=function(){this._from&&this._sync({target:this._from})},h.prototype.off=function(t){if(void 0!==t&&t!==this._from||(this._from.removeEventListener&&this._from.removeEventListener("scroll",this._scrollHandler),this._from=null),void 0===t)this._to=[];else{var e=this._to.indexOf(t);e>=0&&this._to.splice(e,1)}};var v=h,g={data:function(){return{fixed:0,height:void 0,useMax:!1,headHeight:void 0,bodyWidth:void 0,columnWidth:[],headRowHeight:void 0,bodyRowHeight:[],scrollX:0,scrollY:0,hoveredRowIndex:null}},computed:{leftColumnNumber:function(){return e(this.fixed)},rightColumnNumber:function(){return e(this.fixed,!0)},leftColumnWidth:function(){return this.columnWidth.slice(0,this.leftColumnNumber)},rightColumnWidth:function(){return this.columnWidth.slice(-this.rightColumnNumber)},totalWidth:function(){return this.columnWidth.reduce(function(t,e){return t+e},0)},leftTotalWidth:function(){return Math.ceil(this.leftColumnWidth.reduce(function(t,e){return t+e},0))},rightTotalWidth:function(){return Math.ceil(this.rightColumnWidth.reduce(function(t,e){return t+e},0))},mainHeadStyle:function(){return{"margin-right":this.scrollY+"px"}},bodyHeight:function(){if(void 0!==this.height&&void 0!==this.headHeight)return this.height-this.headHeight},bodyStyle:function(){if(void 0!==this.bodyHeight){var t={};return t[this.useMax?"max-height":"height"]=this.bodyHeight+"px",t}},rightWrapperStyle:function(){return{right:this.scrollY+"px"}},fixedBodyStyle:function(){return{"max-height":this.bodyHeight-this.scrollX+"px"}}},watch:{columnWidth:function(){this.$nextTick(this.updateRowHeight)},totalWidth:function(){this.$nextTick(this.updateScrollX)},bodyWidth:{sync:!0,handler:function(t,e){(t>e||null==e)&&this.updateColumnWidth(),this.updateScrollX()}},scrollX:{sync:!0,handler:"updateScrollY"},scrollY:{sync:!0,handler:function(t){t?this.updateScrollX():this.updateColumnWidth()}},bodyHeight:function(){this.$nextTick(this.updateScrollY)}},methods:{updateScrollX:function(){this.$emit("updatescrollx")},updateScrollY:function(){this.$emit("updatescrolly")},updateColumnWidth:function(){this.$emit("updatecolumnwidth")},updateBodyWidth:function(){this.$emit("updatebodywidth")},updateRowHeight:function(){this.$emit("updaterowheight")}},beforeCreate:function(){this.vss=new v(!0,!1),this.hss=new v(!1,!0)}};return{name:"table",props:{columns:{type:Array,default:function(){return[]}},rows:{type:Array,default:function(){return[]}},fixed:{type:[Number,Array],default:0},height:Number,useMax:Boolean,dataBus:null},computed:{leftColumns:function(){return this.columns.slice(0,this.layout.leftColumnNumber)},rightColumns:function(){return this.columns.slice(-this.layout.rightColumnNumber)}},watch:{fixed:{immediate:!0,deep:!0,handler:function(t){this.layout.fixed=t}},height:{immediate:!0,handler:function(t){this.layout.height=t}},useMax:{immediate:!0,handler:function(t){this.layout.useMax=t}},columns:{immediate:!0,deep:!0,sync:!0,handler:function(){this.layoutColumns(!0)}},rows:{deep:!0,handler:function(){var t=this;this.$nextTick(function(e){t.layout.updateScrollY(),t.layout.updateRowHeight()})}}},methods:{resetHoveredRowIndex:function(){this.layout.hoveredRowIndex=null},layoutColumns:function(t){var e=this.layout,n=this.columns,s=e.columnWidth,r=e.bodyWidth;r&&((n.length!==s.length||t)&&(s=i(n)),e.columnWidth=o(s,r))},columnResize:function(t,e){var i=this.columns.indexOf(t),o=this.layout.columnWidth.slice(),n=o[i]+e,s=this.layout;if(e<0){if("number"==typeof t.width&&n<t.width)return;if(s.totalWidth+e<s.bodyWidth)return;if(n<40)return}o.splice(i,1,n),s.columnWidth=o},syncHeight:function(){this.$refs.head&&this.$refs.head.updateHeight(),this.$refs.body&&this.$refs.body.updateRowHeight(!0)}},beforeCreate:function(){this.layout=new t(g)},created:function(){var t=this;this.layout.$on("updatecolumnwidth",function(e){return t.layoutColumns()})},beforeDestroy:function(){this.layout.$off("updatecolumnwidth")},render:function(t){var e,i,o=t("div",{staticClass:"vt__main-wrapper"},[t(c,{style:this.layout.mainHeadStyle,attrs:{columns:this.columns,dataBus:this.dataBus,layout:this.layout},ref:"head",on:{columnResize:this.columnResize}},[]),t(p,{style:this.layout.bodyStyle,attrs:{columns:this.columns,rows:this.rows,dataBus:this.dataBus,layout:this.layout},ref:"body"},[])]);return this.layout.leftColumnNumber&&(e=t("div",{staticClass:"vt__left-wrapper"},[t(c,{attrs:{fixed:"left",columns:this.leftColumns,dataBus:this.dataBus,layout:this.layout},on:{columnResize:this.columnResize}},[]),t(p,{style:this.layout.fixedBodyStyle,attrs:{fixed:"left",columns:this.leftColumns,rows:this.rows,dataBus:this.dataBus,layout:this.layout}},[])])),this.layout.rightColumnNumber&&(i=t("div",{staticClass:"vt__right-wrapper",style:this.layout.rightWrapperStyle},[t(c,{attrs:{fixed:"right",columns:this.rightColumns,dataBus:this.dataBus,layout:this.layout},on:{columnResize:this.columnResize}},[]),t(p,{style:this.layout.fixedBodyStyle,attrs:{fixed:"right",columns:this.rightColumns,rows:this.rows,dataBus:this.dataBus,layout:this.layout}},[])])),t("div",{staticClass:"vt__wrapper",on:{mouseleave:this.resetHoveredRowIndex},ref:"wrapper"},[o,e,i])}}}(Vue);
