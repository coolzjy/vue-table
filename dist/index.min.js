var VueTable=function(t){"use strict";function e(t,e){var i=0;if(Array.isArray(t))t=t[e?1:0];else if(e)return i;return"number"==typeof t&&t>0&&(i=t),i}function i(t,e,i){function o(t){return t*s+n+r}var s=m,n=0,r=0;if(i){var a=i.querySelector(".vt__th");if(a){var u=window.getComputedStyle(a);s=parseInt(u.fontSize),n=parseInt(u.paddingLeft)+parseInt(u.paddingRight),r=parseInt(u.borderLeft)+parseInt(u.borderRight)}}e.columnWidth=t.map(function(t){if("string"==typeof t)return o(t.length);if("object"==typeof t){if("number"==typeof t.width)return t.width;if("string"==typeof t.title)return o(t.title.length)}return y})}function o(t,e){var i=e.bodyWidth-e.totalWidth,o=e.columnWidth.map(function(t){return t+i*t/e.totalWidth});e.columnWidth=o.map(function(e,i){var o="number"==typeof t[i].width?Math.max(p,t[i].width):p;return e<o?o:e})}function s(t,e){return JSON.stringify(t)===JSON.stringify(e)}function n(t,e,i){if("string"==typeof t)return t;if("object"==typeof t){if("function"==typeof t.headComponent)return i(t.headComponent,{props:{column:t,dataBus:e}});if("string"==typeof t.title)return t.title}}function r(t){var e=t.__resizeTriggers__,i=e.firstElementChild,o=e.lastElementChild,s=i.firstElementChild;o.scrollLeft=o.scrollWidth,o.scrollTop=o.scrollHeight,s.style.width=i.offsetWidth+1+"px",s.style.height=i.offsetHeight+1+"px",i.scrollLeft=i.scrollWidth,i.scrollTop=i.scrollHeight}function a(t){return t.offsetWidth!==t.__resizeLast__.width||t.offsetHeight!==t.__resizeLast__.height}function u(t){var e=this;r(this),this.__resizeRAF__&&x(this.__resizeRAF__),this.__resizeRAF__=w(function(){a(e)&&(e.__resizeLast__.width=e.offsetWidth,e.__resizeLast__.height=e.offsetHeight,e.__resizeListeners__.forEach(function(i){i.call(e,t)}))})}function h(){if(!b){var t=(T||"")+".resize-triggers { "+($||"")+'visibility: hidden; opacity: 0; } .resize-triggers, .resize-triggers > div, .contract-trigger:before { content: " "; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',e=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t)),e.appendChild(i),b=!0}}function l(t,e){t.__resizeTriggers__||("static"===getComputedStyle(t).position&&(t.style.position="relative"),h(),t.__resizeLast__={},t.__resizeListeners__=[],(t.__resizeTriggers__=document.createElement("div")).className="resize-triggers",t.__resizeTriggers__.innerHTML='<div class="expand-trigger"><div></div></div><div class="contract-trigger"></div>',t.appendChild(t.__resizeTriggers__),r(t),t.addEventListener("scroll",u,!0),H&&t.__resizeTriggers__.addEventListener(H,function(e){e.animationName===B&&r(t)}),t.__resizeListeners__.push(e))}function d(t,e){t.__resizeListeners__.splice(t.__resizeListeners__.indexOf(e),1),t.__resizeListeners__.length||(t.removeEventListener("scroll",u),t.__resizeTriggers__=!t.removeChild(t.__resizeTriggers__))}function c(t,e,i,o,s){if("string"==typeof t)return e[t];if("object"==typeof t){if("function"==typeof t.bodyComponent)return s(t.bodyComponent,{props:{column:t,row:e,index:i,dataBus:o}});if("string"==typeof t.prop)return e[t.prop]}}function f(t,e,i){this._from=null,this._to=[],this._bindOptions=i?{passive:!0}:void 0,this._sync=function(i){var o=i.target;this._to.forEach(function(i){t&&(i.scrollTop=o.scrollTop),e&&(i.scrollLeft=o.scrollLeft)},this)}.bind(this)}t=t&&t.hasOwnProperty("default")?t.default:t;var m=20,y=100,p=40,g={props:{fixed:String,columns:{type:Array,required:!0},dataBus:null,layout:{type:Object,required:!0}},computed:{width:function(){return this.layout[this.fixed?this.fixed+"ColumnWidth":"columnWidth"]},totalWidth:function(){return this.layout[this.fixed?this.fixed+"TotalWidth":"totalWidth"]},tableStyle:function(){if(this.totalWidth)return{width:this.totalWidth+"px"}}}},_={name:"table-head-cell",props:{column:{type:[String,Object],required:!0},dataBus:null},methods:{dragStart:function(t){this.dragging=!0,this.start=t.clientX,document.body.classList.add("vt__dragging"),document.addEventListener("mousemove",this.dragMove),document.addEventListener("mouseup",this.dragEnd)},dragMove:function(t){var e=this;this.$emit("resize",this.column,t.clientX-this.start,function(i){e.start=t.clientX})},dragEnd:function(t){this.dragging=!1,document.body.classList.remove("vt__dragging"),document.removeEventListener("mousemove",this.dragMove),document.removeEventListener("mouseup",this.dragEnd)}},render:function(t){return t("th",{staticClass:"vt__th"},[n(this.column,this.dataBus,t),!this.column.disableResize&&t("div",{class:"vt-resize-handle",on:{mousedown:this.dragStart}},[])])}},v={name:"table-head",mixins:[g],computed:{rowStyle:function(){if(this.fixed)return{height:this.layout.headRowHeight+"px"}}},methods:{columnResize:function(t,e,i){this.$emit("columnResize",t,e,i)},updateHeight:function(){var t=this;this.$nextTick(function(e){t.layout.headHeight=t.$refs.head.offsetHeight,t.layout.headRowHeight=t.$refs.row.offsetHeight})}},mounted:function(){var t=this;this.fixed||(this.updateHeight(),this.$nextTick(function(e){t.layout.hss.to(t.$refs.head)}))},updated:function(){this.fixed||this.updateHeight()},beforeDestroy:function(){this.fixed||this.layout.hss.off(this.$refs.head)},render:function(t){var e=this;return t("div",{staticClass:"vt-table-head",ref:"head"},[t("table",{staticClass:"vt__table",style:this.tableStyle},[t("colgroup",null,[this.width.map(function(e){return t("col",{style:{width:e+"px"}},[])})]),t("tr",{staticClass:"vt__tr",style:this.rowStyle,ref:"row"},[this.columns.map(function(i,o){return t(_,{attrs:{column:i,dataBus:e.dataBus},on:{resize:e.columnResize},key:o},[])})])])])}},b=!1,w=function(){var t=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(t){return window.setTimeout(t,20)};return function(e){return t(e)}}(),x=function(){var t=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.clearTimeout;return function(e){return t(e)}}(),C=!1,W="",H="animationstart",z="Webkit Moz O ms".split(" "),R="webkitAnimationStart animationstart oAnimationStart MSAnimationStart".split(" "),S=document.createElement("fakeelement");if(void 0!==S.style.animationName&&(C=!0),!1===C)for(var L=0;L<z.length;L++)if(void 0!==S.style[z[L]+"AnimationName"]){W="-"+z[L].toLowerCase()+"-",H=R[L],C=!0;break}var B="resizeanim",T="@"+W+"keyframes "+B+" { from { opacity: 0; } to { opacity: 0; } } ",$=W+"animation: 1ms "+B+";",E={name:"table-body-cell",functional:!0,props:{column:{type:[String,Object],required:!0},row:{type:Object,required:!0},index:{type:Number,required:!0},dataBus:null},render:function(t,e){var i=c(e.props.column,e.props.row,e.props.index,e.props.dataBus,t);return t("td",{staticClass:"vt__td",class:{vt__td__covered:e.props.covered},attrs:{title:"string"==typeof i?i:""}},[i])}},A={name:"table-body",mixins:[g],props:{rows:{type:Array,required:!0}},methods:{getRowClass:function(t){return{vt__tr__hover:t===this.layout.hoveredRowIndex}},getRowStyle:function(t){if(this.fixed)return"number"==typeof this.layout.bodyRowHeight[t]?{height:this.layout.bodyRowHeight[t]+"px"}:void 0},updateHoveredRowIndex:function(t){this.layout.hoveredRowIndex=t},updateWidth:function(){var t=this;this.fixed||setTimeout(function(e){t.layout.bodyWidth=t.$refs.body.clientWidth},0)},updateScrollbar:function(){if(!this.fixed){var t=this.$refs.body;this.layout.scrollbarWidth=t.offsetWidth-t.clientWidth,this.layout.scrollbarHeight=t.offsetHeight-t.clientHeight}},updateRowHeight:function(t){var e=this;this.fixed||this.$nextTick(function(i){var o=e.$refs.rows.map(function(t){return t.offsetHeight});s(o,e.layout.bodyRowHeight)&&!t||(e.layout.bodyRowHeight=o)})}},created:function(){this.fixed||(this.layout.$on("updatescrollbar",this.updateScrollbar),this.layout.$on("updatebodywidth",this.updateWidth))},mounted:function(){var t=this;this.$nextTick(function(e){var i=t.$refs.body;t.layout.vss[t.fixed?"to":"from"](i),t.fixed||(t.layout.hss.from(i),l(i,t.updateWidth))})},updated:function(){this.updateScrollbar(),this.updateRowHeight()},beforeDestroy:function(){var t=this.$refs.body;this.layout.vss.off(t),this.fixed||(this.layout.hss.off(t),this.layout.$off("updatescrollbar",this.updateScrollbar),this.layout.$off("updatebodywidth",this.updateWidth),d(t,this.updateWidth))},render:function(t){var e=this;return t("div",{staticClass:"vt-table-body",style:{"overflow-y":this.fixed?"hidden":"auto"},ref:"body"},[t("table",{staticClass:"vt__table",style:this.tableStyle},[t("colgroup",null,[this.width.map(function(e){return t("col",{style:{width:e+"px"}},[])})]),this.rows.map(function(i,o){return t("tr",{staticClass:"vt__tr",class:e.getRowClass(o),style:e.getRowStyle(o),on:{mouseenter:function(t){e.updateHoveredRowIndex(o)}},key:o,ref:"rows",refInFor:!0},[e.columns.map(function(s,n){return t(E,{attrs:{column:s,row:i,index:o,dataBus:e.dataBus},key:n},[])})])})])])}};f.prototype.from=function(t){t&&t.addEventListener&&(this._from=t,this._from.addEventListener("scroll",this._sync,this._bindOptions))},f.prototype.to=function(t){t&&this._to.push(t)},f.prototype.sync=function(){this._from&&this._sync({target:this._from})},f.prototype.off=function(t){if(void 0!==t&&t!==this._from||(this._from.removeEventListener&&this._from.removeEventListener("scroll",this._scrollHandler),this._from=null),void 0===t)this._to=[];else{var e=this._to.indexOf(t);e>=0&&this._to.splice(e,1)}};var N=f,k={data:function(){return{fixed:0,height:void 0,useMax:!1,headHeight:void 0,bodyWidth:void 0,columnWidth:[],headRowHeight:void 0,bodyRowHeight:[],scrollbarWidth:0,scrollbarHeight:0,hoveredRowIndex:null}},computed:{leftColumnNumber:function(){return e(this.fixed)},rightColumnNumber:function(){return e(this.fixed,!0)},leftColumnWidth:function(){return this.columnWidth.slice(0,this.leftColumnNumber)},rightColumnWidth:function(){return this.columnWidth.slice(-this.rightColumnNumber)},totalWidth:function(){return this.columnWidth.reduce(function(t,e){return t+e},0)},leftTotalWidth:function(){return Math.ceil(this.leftColumnWidth.reduce(function(t,e){return t+e},0))},rightTotalWidth:function(){return Math.ceil(this.rightColumnWidth.reduce(function(t,e){return t+e},0))},mainHeadStyle:function(){return{"margin-right":this.scrollbarWidth+"px"}},bodyHeight:function(){if(void 0!==this.height&&void 0!==this.headHeight)return this.height-this.headHeight},bodyStyle:function(){if(void 0!==this.bodyHeight){var t={};return t[this.useMax?"max-height":"height"]=this.bodyHeight+"px",t}},rightWrapperStyle:function(){return{right:this.scrollbarWidth+"px"}},fixedBodyStyle:function(){return{"max-height":this.bodyHeight-this.scrollbarHeight+"px"}}},watch:{bodyWidth:"updateScrollbar",bodyHeight:"updateScrollbar",scrollbarWidth:"updateBodyWidth"},methods:{updateScrollbar:function(){this.$emit("updatescrollbar")},updateBodyWidth:function(){this.$emit("updatebodywidth")}},beforeCreate:function(){this.vss=new N(!0,!1),this.hss=new N(!1,!0)}};return{name:"table",props:{columns:{type:Array,default:function(){return[]}},rows:{type:Array,default:function(){return[]}},fixed:{type:[Number,Array],default:0},height:Number,useMax:Boolean,dataBus:null},data:function(){return{layoutComplete:!1}},computed:{leftColumns:function(){return this.columns.slice(0,this.layout.leftColumnNumber)},rightColumns:function(){return this.columns.slice(-this.layout.rightColumnNumber)}},watch:{fixed:{immediate:!0,deep:!0,handler:function(t){this.layout.fixed=t}},height:{immediate:!0,handler:function(t){this.layout.height=t}},useMax:{immediate:!0,handler:function(t){this.layout.useMax=t}},columns:{deep:!0,handler:function(){var t=this;this.$nextTick(function(e){t.layoutColumns(!0)})}},rows:{deep:!0,handler:"syncHeight"},"layout.bodyWidth":function(){this.layoutComplete&&0!==this.layout.scrollbarHeight||this.layoutColumns()}},methods:{resetHoveredRowIndex:function(){this.layout.hoveredRowIndex=null},layoutColumns:function(t){(this.columns.length!==this.layout.columnWidth.length||t)&&i(this.columns,this.layout,this.$refs.head.$el),o(this.columns,this.layout),this.layoutComplete||(this.layoutComplete=!0)},columnResize:function(t,e,i){var o=this.columns.indexOf(t),s=this.layout.columnWidth[o]+e,n=this.layout;if(e<0){if("number"==typeof t.width&&s<t.width)return;if(n.totalWidth+e<n.bodyWidth)return;if(s<p)return}n.columnWidth.splice(o,1,s),i&&i()},syncHeight:function(){this.$refs.head&&this.$refs.head.updateHeight(),this.$refs.body&&this.$refs.body.updateRowHeight(!0)}},beforeCreate:function(){this.layout=new t(k)},render:function(t){var e,i,o=t("div",{staticClass:"vt__main-wrapper"},[t(v,{style:this.layout.mainHeadStyle,attrs:{columns:this.columns,dataBus:this.dataBus,layout:this.layout},ref:"head",on:{columnResize:this.columnResize}},[]),t(A,{style:this.layout.bodyStyle,attrs:{columns:this.columns,rows:this.rows,dataBus:this.dataBus,layout:this.layout},ref:"body"},[])]);return this.layout.leftColumnNumber&&(e=t("div",{staticClass:"vt__left-wrapper"},[t(v,{attrs:{fixed:"left",columns:this.leftColumns,dataBus:this.dataBus,layout:this.layout},on:{columnResize:this.columnResize}},[]),t(A,{style:this.layout.fixedBodyStyle,attrs:{fixed:"left",columns:this.leftColumns,rows:this.rows,dataBus:this.dataBus,layout:this.layout}},[])])),this.layout.rightColumnNumber&&(i=t("div",{staticClass:"vt__right-wrapper",style:this.layout.rightWrapperStyle},[t(v,{attrs:{fixed:"right",columns:this.rightColumns,dataBus:this.dataBus,layout:this.layout},on:{columnResize:this.columnResize}},[]),t(A,{style:this.layout.fixedBodyStyle,attrs:{fixed:"right",columns:this.rightColumns,rows:this.rows,dataBus:this.dataBus,layout:this.layout}},[])])),t("div",{staticClass:"vt__wrapper",style:{visibility:this.layoutComplete?"visible":"hidden"},on:{mouseleave:this.resetHoveredRowIndex},ref:"wrapper"},[o,e,i])}}}(Vue);
