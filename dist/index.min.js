var VueTable=function(t){"use strict";function e(t,e){var i=0;if(Array.isArray(t))t=t[e?1:0];else if(e)return i;return"number"==typeof t&&t>0&&(i=t),i}function i(t){function e(t){return 20*t}return t.map(function(t){if("string"==typeof t)return e(t.length);if("object"==typeof t){if("number"==typeof t.width)return t.width;if("string"==typeof t.title)return e(t.title.length)}return h})}function o(t,e){var i=t.reduce(function(t,e){return t+e},0);if(i>=e)return t;var o=e-i;return t.map(function(t){return t+o*t/i})}function s(t,e){return JSON.stringify(t)===JSON.stringify(e)}function n(t,e,i){if("string"==typeof t)return t;if("object"==typeof t){if("function"==typeof t.headComponent)return i(t.headComponent,{props:{column:t,dataBus:e}});if("string"==typeof t.title)return t.title}}function r(t,e){var i=Object.prototype.toString.call(t),o="[object Array]"===i||"[object NodeList]"===i||"[object HTMLCollection]"===i||"[object Object]"===i||"undefined"!=typeof jQuery&&t instanceof jQuery||"undefined"!=typeof Elements&&t instanceof Elements,s=0,n=t.length;if(o)for(;s<n;s++)e(t[s]);else e(t)}function u(t,e,i,o,s){if("string"==typeof t)return e[t];if("object"==typeof t){if("function"==typeof t.bodyComponent)return s(t.bodyComponent,{props:{column:t,row:e,index:i,dataBus:o}});if("string"==typeof t.prop)return e[t.prop]}}function l(t,e){this._from=null,this._to=[],this._sync=function(i){for(var o=i.target,s=0;s<this._to.length;s++)t&&(this._to[s].scrollTop=o.scrollTop),e&&(this._to[s].scrollLeft=o.scrollLeft)}.bind(this)}t=t&&t.hasOwnProperty("default")?t.default:t;var h=100,d={props:{fixed:String,columns:{type:Array,required:!0},dataBus:null,layout:{type:Object,required:!0}},computed:{width:function(){return this.layout[this.fixed?this.fixed+"ColumnWidth":"columnWidth"]},totalWidth:function(){return this.layout[this.fixed?this.fixed+"TotalWidth":"totalWidth"]},tableStyle:function(){if(this.totalWidth)return{width:this.totalWidth+"px"}}}},a={name:"table-head-cell",props:{column:{type:[String,Object],required:!0},dataBus:null},methods:{resizeStart:function(t){this.start=t.clientX,document.body.classList.add("vt__dragging"),document.addEventListener("mouseup",this.resizeEnd)},resizeEnd:function(t){document.body.classList.remove("vt__dragging"),this.$emit("resize",this.column,t.clientX-this.start),document.removeEventListener("mouseup",this.resizeEnd)}},render:function(t){return t("th",{staticClass:"vt__th"},[n(this.column,this.dataBus,t),!this.column.disableResize&&t("div",{class:"vt-resize-handle",on:{mousedown:this.resizeStart}},[])])}},c={name:"table-head",mixins:[d],computed:{rowStyle:function(){if(this.fixed)return{height:this.layout.headRowHeight+"px"}}},methods:{columnResize:function(t,e,i){this.$emit("columnResize",t,e,i)},updateHeight:function(){var t=this;this.$nextTick(function(e){t.layout.headHeight=t.$refs.head.offsetHeight,t.layout.headRowHeight=t.$refs.row.offsetHeight})}},mounted:function(){var t=this;this.fixed||(this.updateHeight(),this.$nextTick(function(e){t.layout.hss.to(t.$refs.head)}))},updated:function(){this.fixed||this.updateHeight()},beforeDestroy:function(){this.fixed||this.layout.hss.off(this.$refs.head)},render:function(t){var e=this;return t("div",{staticClass:"vt-table-head",ref:"head"},[t("table",{staticClass:"vt__table",style:this.tableStyle},[t("colgroup",null,[this.width.map(function(e){return t("col",{style:{width:e+"px"}},[])})]),t("tr",{staticClass:"vt__tr",style:this.rowStyle,ref:"row"},[this.columns.map(function(i,o){return t(a,{attrs:{column:i,dataBus:e.dataBus},on:{resize:e.columnResize},key:o},[])})])])])}},f=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(t){return window.setTimeout(t,20)},y=function(t,e){function i(){var t=[];this.add=function(e){t.push(e)};var e,i;this.call=function(){for(e=0,i=t.length;e<i;e++)t[e].call()},this.remove=function(o){var s=[];for(e=0,i=t.length;e<i;e++)t[e]!==o&&s.push(t[e]);t=s},this.length=function(){return t.length}}function o(t,e){if(t)if(t.resizedAttached)t.resizedAttached.add(e);else{t.resizedAttached=new i,t.resizedAttached.add(e),t.resizeSensor=document.createElement("div"),t.resizeSensor.className="resize-sensor";var o="position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;",s="position: absolute; left: 0; top: 0; transition: 0s;";t.resizeSensor.style.cssText=o,t.resizeSensor.innerHTML='<div class="resize-sensor-expand" style="'+o+'"><div style="'+s+'"></div></div><div class="resize-sensor-shrink" style="'+o+'"><div style="'+s+' width: 200%; height: 200%"></div></div>',t.appendChild(t.resizeSensor),t.resizeSensor.offsetParent!==t&&(t.style.position="relative");var n,r,u,l,h=t.resizeSensor.childNodes[0],d=h.childNodes[0],a=t.resizeSensor.childNodes[1],c=t.offsetWidth,y=t.offsetHeight,m=function(){d.style.width="100000px",d.style.height="100000px",h.scrollLeft=1e5,h.scrollTop=1e5,a.scrollLeft=1e5,a.scrollTop=1e5};m();var p=function(){r=0,n&&(c=u,y=l,t.resizedAttached&&t.resizedAttached.call())},v=function(){u=t.offsetWidth,l=t.offsetHeight,(n=u!=c||l!=y)&&!r&&(r=f(p)),m()},g=function(t,e,i){t.attachEvent?t.attachEvent("on"+e,i):t.addEventListener(e,i)};g(h,"scroll",v),g(a,"scroll",v)}}r(t,function(t){o(t,e)}),this.detach=function(e){y.detach(t,e)}};y.detach=function(t,e){r(t,function(t){t&&(t.resizedAttached&&"function"==typeof e&&(t.resizedAttached.remove(e),t.resizedAttached.length())||t.resizeSensor&&(t.contains(t.resizeSensor)&&t.removeChild(t.resizeSensor),delete t.resizeSensor,delete t.resizedAttached))})};var m={name:"table-body-cell",functional:!0,props:{column:{type:[String,Object],required:!0},row:{type:Object,required:!0},index:{type:Number,required:!0},dataBus:null},render:function(t,e){var i=u(e.props.column,e.props.row,e.props.index,e.props.dataBus,t);return t("td",{staticClass:"vt__td",class:{vt__td__covered:e.props.covered},attrs:{title:"string"==typeof i?i:""}},[i])}},p={name:"table-body",mixins:[d],props:{rows:{type:Array,required:!0},selected:Object},methods:{getRowClass:function(t,e){return{vt__tr__hover:e===this.layout.hoveredRowIndex,vt__tr__selected:t===this.selected}},getRowStyle:function(t){if(this.fixed)return"number"==typeof this.layout.bodyRowHeight[t]?{height:this.layout.bodyRowHeight[t]+"px"}:void 0},updateHoveredRowIndex:function(t){this.layout.hoveredRowIndex=t},updateWidth:function(){this.layout.bodyWidth=this.$refs.body.clientWidth},updateScrollX:function(){var t=this.$refs.body;this.layout.scrollX=t.offsetHeight-t.clientHeight},updateScrollY:function(){var t=this.$refs.body;this.layout.scrollY=t.offsetWidth-t.clientWidth},updateRowHeight:function(t){if(this.$refs.rows){var e=this.$refs.rows.map(function(t){return t.offsetHeight});s(e,this.layout.bodyRowHeight)&&!t||(this.layout.bodyRowHeight=e)}}},created:function(){this.fixed||(this.layout.$on("updatescrollx",this.updateScrollX),this.layout.$on("updatescrolly",this.updateScrollY),this.layout.$on("updatebodywidth",this.updateWidth),this.layout.$on("updaterowheight",this.updateRowHeight))},mounted:function(){var t=this;this.$nextTick(function(e){var i=t.$refs.body;t.layout.vss[t.fixed?"to":"from"](i),t.fixed||(t.updateWidth(),t.layout.hss.from(i),t.resizeSensor=new y(i,t.updateWidth))})},beforeDestroy:function(){var t=this.$refs.body;this.layout.vss.off(t),this.fixed||(this.layout.hss.off(t),this.layout.$off("updatescrollx",this.updateScrollX),this.layout.$off("updatescrolly",this.updateScrollY),this.layout.$off("updatebodywidth",this.updateWidth),this.resizeSensor.detach())},render:function(t){var e=this;return t("div",{ref:"body",staticClass:"vt-table-body",style:{overflow:this.fixed?"hidden":"auto"}},[t("table",{staticClass:"vt__table",style:this.tableStyle},[t("colgroup",null,[this.width.map(function(e){return t("col",{style:{width:e+"px"}},[])})]),this.rows.map(function(i,o){return t("tr",{staticClass:"vt__tr",class:e.getRowClass(i,o),style:e.getRowStyle(o),on:{click:function(t){e.$emit("select",i)},mouseenter:function(t){e.updateHoveredRowIndex(o)}},key:o,ref:"rows",refInFor:!0},[e.columns.map(function(s,n){return t(m,{attrs:{column:s,row:i,index:o,dataBus:e.dataBus},key:n},[])})])})])])}};l.prototype.from=function(t){t&&t.addEventListener&&(this._from=t,this._from.addEventListener("scroll",this._sync))},l.prototype.to=function(t){t&&this._to.push(t)},l.prototype.sync=function(){this._from&&this._sync({target:this._from})},l.prototype.off=function(t){if(void 0!==t&&t!==this._from||(this._from.removeEventListener&&this._from.removeEventListener("scroll",this._scrollHandler),this._from=null),void 0===t)this._to=[];else{var e=this._to.indexOf(t);e>=0&&this._to.splice(e,1)}};var v=l,g={data:function(){return{fixed:0,height:void 0,useMax:!1,headHeight:void 0,bodyWidth:void 0,columnWidth:[],headRowHeight:void 0,bodyRowHeight:[],scrollX:0,scrollY:0,hoveredRowIndex:null}},computed:{leftColumnNumber:function(){return e(this.fixed)},rightColumnNumber:function(){return e(this.fixed,!0)},leftColumnWidth:function(){return this.columnWidth.slice(0,this.leftColumnNumber)},rightColumnWidth:function(){return this.columnWidth.slice(-this.rightColumnNumber)},totalWidth:function(){return this.columnWidth.reduce(function(t,e){return t+e},0)},leftTotalWidth:function(){return Math.ceil(this.leftColumnWidth.reduce(function(t,e){return t+e},0))},rightTotalWidth:function(){return Math.ceil(this.rightColumnWidth.reduce(function(t,e){return t+e},0))},mainHeadStyle:function(){return{"margin-right":this.scrollY+"px"}},bodyHeight:function(){if(void 0!==this.height&&void 0!==this.headHeight)return this.height-this.headHeight},bodyStyle:function(){if(void 0!==this.bodyHeight){var t={};return t[this.useMax?"max-height":"height"]=this.bodyHeight+"px",t}},rightWrapperStyle:function(){return{right:this.scrollY+"px"}},fixedBodyStyle:function(){return{"max-height":this.bodyHeight-this.scrollX+"px"}}},watch:{columnWidth:function(){this.$nextTick(this.updateRowHeight)},totalWidth:function(){this.$nextTick(this.updateScrollX)},bodyWidth:{sync:!0,handler:function(t,e){(t>e||null==e)&&this.updateColumnWidth(),this.updateScrollX()}},scrollX:{sync:!0,handler:"updateScrollY"},scrollY:{sync:!0,handler:function(t){t?this.updateScrollX():this.updateColumnWidth()}},bodyHeight:function(){this.$nextTick(this.updateScrollY)}},methods:{updateScrollX:function(){this.$emit("updatescrollx")},updateScrollY:function(){this.$emit("updatescrolly"),0!==this.scrollY&&0===this.scrollX&&this.updateScrollX()},updateColumnWidth:function(){this.$emit("updatecolumnwidth")},updateBodyWidth:function(){this.$emit("updatebodywidth")},updateRowHeight:function(){this.$emit("updaterowheight")}},beforeCreate:function(){this.vss=new v(!0,!1),this.hss=new v(!1,!0)}};return{name:"table",props:{columns:{type:Array,default:function(){return[]}},rows:{type:Array,default:function(){return[]}},fixed:{type:[Number,Array],default:0},height:Number,useMax:Boolean,selected:Object,dataBus:null},computed:{leftColumns:function(){return this.columns.slice(0,this.layout.leftColumnNumber)},rightColumns:function(){return this.columns.slice(-this.layout.rightColumnNumber)}},watch:{fixed:{immediate:!0,deep:!0,handler:function(t){this.layout.fixed=t}},height:{immediate:!0,handler:function(t){this.layout.height=t}},useMax:{immediate:!0,handler:function(t){this.layout.useMax=t}},columns:{immediate:!0,deep:!0,sync:!0,handler:function(){this.layoutColumns(!0)}},rows:{immediate:!0,deep:!0,handler:function(t){var e=this;this.select(t&&t.length?t[0]:null),setTimeout(function(t){e.layout.updateScrollY(),e.layout.updateRowHeight()},0)}}},methods:{select:function(t){this.$emit("update:selected",t)},resetHoveredRowIndex:function(){this.layout.hoveredRowIndex=null},layoutColumns:function(t){var e=this.layout,s=this.columns,n=e.columnWidth,r=e.bodyWidth;r&&((s.length!==n.length||t)&&(n=i(s)),e.columnWidth=o(n,r))},columnResize:function(t,e){var i=this.columns.indexOf(t),o=this.layout.columnWidth.slice(),s=o[i]+e,n=this.layout;if(e<0){if("number"==typeof t.width&&s<t.width)return;if(n.totalWidth+e<n.bodyWidth)return;if(s<40)return}o.splice(i,1,s),n.columnWidth=o},syncHeight:function(){this.$refs.head&&this.$refs.head.updateHeight(),this.$refs.body&&this.$refs.body.updateRowHeight(!0)}},beforeCreate:function(){this.layout=new t(g)},created:function(){var t=this;this.layout.$on("updatecolumnwidth",function(e){return t.layoutColumns()})},beforeDestroy:function(){this.layout.$off("updatecolumnwidth")},render:function(t){var e,i,o=t("div",{staticClass:"vt__main-wrapper"},[t(c,{style:this.layout.mainHeadStyle,attrs:{columns:this.columns,dataBus:this.dataBus,layout:this.layout},ref:"head",on:{columnResize:this.columnResize}},[]),t(p,{style:this.layout.bodyStyle,attrs:{columns:this.columns,rows:this.rows,dataBus:this.dataBus,layout:this.layout,selected:this.selected},on:{select:this.select},ref:"body"},[])]);return this.layout.leftColumnNumber&&(e=t("div",{staticClass:"vt__left-wrapper"},[t(c,{attrs:{fixed:"left",columns:this.leftColumns,dataBus:this.dataBus,layout:this.layout},on:{columnResize:this.columnResize}},[]),t(p,{style:this.layout.fixedBodyStyle,attrs:{fixed:"left",columns:this.leftColumns,rows:this.rows,dataBus:this.dataBus,layout:this.layout,selected:this.selected},on:{select:this.select}},[])])),this.layout.rightColumnNumber&&(i=t("div",{staticClass:"vt__right-wrapper",style:this.layout.rightWrapperStyle},[t(c,{attrs:{fixed:"right",columns:this.rightColumns,dataBus:this.dataBus,layout:this.layout},on:{columnResize:this.columnResize}},[]),t(p,{style:this.layout.fixedBodyStyle,attrs:{fixed:"right",columns:this.rightColumns,rows:this.rows,dataBus:this.dataBus,layout:this.layout,selected:this.selected},on:{select:this.select}},[])])),t("div",{staticClass:"vt__wrapper",on:{mouseleave:this.resetHoveredRowIndex},ref:"wrapper"},[o,e,i])}}}(Vue);
